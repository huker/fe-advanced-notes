## Vue3

> 这边主要是设计、原理、实现，怎么使用vue3做开发这事儿等后面单独开一个最佳实践的repo做练习和记录

### 1.设计思想

#### 和2的差别（设计思路层面）

- 注重模块拆分 模块间耦合低 可以独立使用
- 2中很多挂载到实例上的没用到的方法都会被一起打包，现利用tree-shacking按需打包，减小包体积
- 允许自定义渲染器，不需要去改源码了，扩展性变强

#### 保留的思想

- 声明式框架：使用简单，不用关注实现的过程，只要按照规定使用就行（其实也是降低了技术门槛，用法都给你了，不需要考验实现的好不好
- 虚拟dom：数据变化视图需要更新的时候对比新旧虚拟节点，找到变化的地方来更新
- 区分编译时和运行时：把模板编译成虚拟dom对象，运行时将虚拟dom渲染成真实dom

### 2.架构

#### monorepo方式管理项目

在一个仓库（repo）中管理多个模块（package）

- 一个仓库管理多个模块，不用到处找
- 方便版本管理、依赖管理，模块间的引用调用都很方便
- 包可以独立发布

#### vue3项目组成

- compiler-core 与平台无关的核心代码编译
- compiler-dom 针对浏览器的编译模块
- compiler-sfc 针对单文件解析
- compiler-ssr 针对服务端渲染的编译模块
- reactivity 响应式系统
- template-explorer 用于调试编译输出的开发工具
- vue-compact 迁移构建，用于兼容vue2
- runtime-core 与平台无关的运行时核心
- runtime-dom 针对浏览器的运行时，包括DOM API、属性、事件处理等
- runtime-test 用于测试的运行时
- server-renderer 用于服务端渲染
- shared 多个包之间共享的内容
- vue 完整版本，包括运行时和编译器
- ref-transform 实验性语法，ref转换器
- size-check 用来测试代码体积

#### vue3使用ts

没什么好说的，ts的写法我是乱用的程度，等我后面补一补QAQ

#### vue3开发环境搭建

1.使用pnpm（速度快、节省磁盘空间），全局安装，初始化

```
sudo npm install pnpm -g 
pnpm init
```

使用pnpm的管理多模块功能，在根目录下创建pnpm-workspace.yaml，packages指定的路径就是所有要写的模块的目录

pnpm和npm很大一个差别就是依赖的结构，npm是打平的，pnpm这边不是，比如在整个项目的根目录terminal下执行pnpm install vue，
这时会报错，报错是因为pnpm不知道你到底是要安装在根目录下的依赖，还是某个package，如果是根目录大家共同使用的话要加-w，安装后可以发现，
它不是所有包都在node_modules里，它是符号连接的形式，里面只有一个vue，然后依赖的包都在.pnpm里面，这样性能可以提升

npm有个特点，比如安装了bootstrap，会自带安装animate.css 不用重新安装animate就可以使用（幽灵依赖）
